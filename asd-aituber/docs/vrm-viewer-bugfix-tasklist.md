# VRM Viewer „Éê„Ç∞„Éï„Ç£„ÉÉ„ÇØ„Çπ TDD„Çø„Çπ„ÇØ„É™„Çπ„Éà

## üéØ TDD (Test-Driven Development) „Ç¢„Éó„É≠„Éº„ÉÅ

ÂêÑ„Çø„Çπ„ÇØ„ÅØ‰ª•‰∏ã„ÅÆÈ†ÜÂ∫è„ÅßÂÆüË°å„Åó„Åæ„ÅôÔºö
1. **Red**: Â§±Êïó„Åô„Çã„ÉÜ„Çπ„Éà„ÇíÊõ∏„Åè
2. **Green**: „ÉÜ„Çπ„Éà„ÇíÈÄöÈÅé„Åô„ÇãÊúÄÂ∞èÈôê„ÅÆÂÆüË£Ö
3. **Refactor**: „Ç≥„Éº„Éâ„ÅÆÂìÅË≥™Âêë‰∏ä

---

## üî¥ Phase A: Á∑äÊÄ•Ë™øÊüª„ÉªÁí∞Â¢ÉÁ¢∫Ë™ç„ÉÜ„Çπ„Éà (1-2ÊôÇÈñì)

### A.1: WebGLÂØæÂøúÁ¢∫Ë™ç„ÉÜ„Çπ„Éà
```typescript
// __tests__/utils/webgl-check.test.ts
describe('WebGL Support Check', () => {
  test('should detect WebGL support in browser', () => {
    const isWebGLSupported = checkWebGLSupport()
    expect(isWebGLSupported).toBeDefined()
    expect(typeof isWebGLSupported).toBe('boolean')
  })
  
  test('should provide fallback for non-WebGL environments', () => {
    // Mock WebGL‰∏çÂØæÂøúÁí∞Â¢É
    const mockCanvas = { getContext: jest.fn(() => null) }
    const result = checkWebGLSupport(mockCanvas)
    expect(result).toBe(false)
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] `utils/webgl-check.ts` „Çí‰ΩúÊàê
- [ ] WebGLÂØæÂøú„ÉÅ„Çß„ÉÉ„ÇØÈñ¢Êï∞„ÇíÂÆüË£Ö
- [ ] ChatPage„Åß‰ΩøÁî®„Åß„Åç„Çã„Çà„ÅÜ„Å´export

### A.2: VRM„Éï„Ç°„Ç§„É´Â≠òÂú®Á¢∫Ë™ç„ÉÜ„Çπ„Éà
```typescript
// __tests__/utils/vrm-loader.test.ts
describe('VRM File Loader', () => {
  test('should check if VRM file exists', async () => {
    const exists = await checkVRMFileExists('/models/MyAvatar01_20241125134913.vrm')
    expect(exists).toBeDefined()
  })
  
  test('should handle missing VRM file gracefully', async () => {
    const exists = await checkVRMFileExists('/models/non-existent.vrm')
    expect(exists).toBe(false)
  })
  
  test('should provide file size information', async () => {
    const info = await getVRMFileInfo('/models/MyAvatar01_20241125134913.vrm')
    expect(info).toHaveProperty('size')
    expect(info.size).toBeGreaterThan(0)
  })
  
  // Êñ∞Ë¶èËøΩÂä†: AbortSignal.timeout()‰∫íÊèõÊÄß„ÉÜ„Çπ„Éà
  test('should handle browsers without AbortSignal.timeout support', async () => {
    // AbortSignal.timeout„Çíundefined„Å´„É¢„ÉÉ„ÇØ
    const originalTimeout = AbortSignal.timeout
    ;(AbortSignal as any).timeout = undefined
    
    // Èñ¢Êï∞„ÅåÊ≠£Â∏∏„Å´Âãï‰Ωú„Åô„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    const exists = await checkVRMFileExists('/models/test.vrm')
    expect(exists).toBeDefined()
    
    // ÂÖÉ„Å´Êàª„Åô
    ;(AbortSignal as any).timeout = originalTimeout
  })
  
  test('should timeout correctly with fallback implementation', async () => {
    // ÈÅÖ„ÅÑ„É¨„Çπ„Éù„É≥„Çπ„Çí„Ç∑„Éü„É•„É¨„Éº„Éà
    global.fetch = jest.fn(() => 
      new Promise(resolve => setTimeout(resolve, 10000))
    )
    
    const startTime = Date.now()
    const exists = await checkVRMFileExists('/models/slow.vrm')
    const duration = Date.now() - startTime
    
    expect(exists).toBe(false)
    expect(duration).toBeLessThan(6000) // 5Áßí + ‰ΩôË£ï
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] `utils/vrm-loader.ts` „Çí‰ΩúÊàê
- [ ] VRM„Éï„Ç°„Ç§„É´Â≠òÂú®Á¢∫Ë™çÈñ¢Êï∞„ÇíÂÆüË£ÖÔºàAbortController‰ΩøÁî®Ôºâ
- [ ] AbortSignal.timeout()„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂÆüË£Ö
- [ ] „Çø„Ç§„É†„Ç¢„Ç¶„ÉàÂá¶ÁêÜ„ÅÆÈÅ©Âàá„Å™ÂÆüË£Ö
- [ ] „Éï„Ç°„Ç§„É´ÊÉÖÂ†±ÂèñÂæóÈñ¢Êï∞„ÇíÂÆüË£Ö

### A.3: ‰æùÂ≠òÈñ¢‰øÇ„Éê„Éº„Ç∏„Éß„É≥„ÉÜ„Çπ„Éà
```typescript
// __tests__/utils/dependency-check.test.ts
describe('Dependency Version Check', () => {
  test('should verify Three.js version compatibility', () => {
    const threeVersion = getThreeJsVersion()
    expect(threeVersion).toMatch(/^0\.1[567]\d\./)
  })
  
  test('should verify @pixiv/three-vrm version', () => {
    const vrmVersion = getVRMLibVersion()
    expect(vrmVersion).toMatch(/^2\.\d+\.\d+/)
  })
  
  // Êñ∞Ë¶èËøΩÂä†: package.jsonÁõ¥Êé•„Ç¢„ÇØ„Çª„ÇπÂõûÈÅø„ÉÜ„Çπ„Éà
  test('should not use dynamic require for package.json', () => {
    // getThreeJsVersionÂÜÖ„Åßrequire()„Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„Å™„ÅÑ„Åì„Å®„ÇíÁ¢∫Ë™ç
    const fnString = getThreeJsVersion.toString()
    expect(fnString).not.toContain('require(')
    expect(fnString).not.toContain('package.json')
  })
  
  test('should handle SSR environment correctly', () => {
    // SSRÁí∞Â¢É„Çí„Ç∑„Éü„É•„É¨„Éº„Éà
    const originalWindow = global.window
    delete (global as any).window
    
    const version = getThreeJsVersion()
    expect(version).toBeDefined()
    expect(version).not.toBe('unknown')
    
    // Áí∞Â¢É„ÇíÂæ©ÂÖÉ
    global.window = originalWindow
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] `utils/dependency-check.ts` „Çí‰ΩúÊàê
- [ ] „Éë„ÉÉ„Ç±„Éº„Ç∏„Éê„Éº„Ç∏„Éß„É≥Á¢∫Ë™çÈñ¢Êï∞„ÇíÂÆüË£ÖÔºàÂãïÁöÑrequire()„Çí‰ΩøÁî®„Åó„Å™„ÅÑÔºâ
- [ ] SSR/CSRÁí∞Â¢ÉÂØæÂøú„ÅÆÂÆüË£Ö
- [ ] Áí∞Â¢ÉÂ§âÊï∞„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„ÅÆËøΩÂä†
- [ ] ‰∫íÊèõÊÄß„ÉÅ„Çß„ÉÉ„ÇØÊ©üËÉΩ„ÇíËøΩÂä†

### A.4: „Éñ„É©„Ç¶„Ç∂‰∫íÊèõÊÄß„ÉÅ„Çß„ÉÉ„ÇØ„ÉÜ„Çπ„Éà
```typescript
// __tests__/utils/browser-compat.test.ts
describe('Browser Compatibility Check', () => {
  test('should detect AbortSignal.timeout support', () => {
    const hasSupport = checkAbortSignalTimeoutSupport()
    expect(typeof hasSupport).toBe('boolean')
  })
  
  test('should create timeout signal with fallback', async () => {
    const signal = createTimeoutSignal(1000)
    expect(signal).toBeInstanceOf(AbortSignal)
    
    // „Çø„Ç§„É†„Ç¢„Ç¶„ÉàÂæå„Å´aborted„Ååtrue„Å´„Å™„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
    await new Promise(resolve => setTimeout(resolve, 1100))
    expect(signal.aborted).toBe(true)
  })
  
  test('should detect browser features correctly', () => {
    const features = detectBrowserFeatures()
    expect(features).toHaveProperty('webgl')
    expect(features).toHaveProperty('abortSignalTimeout')
    expect(features).toHaveProperty('dynamicImport')
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] `utils/browser-compat.ts` „Çí‰ΩúÊàê
- [ ] AbortSignal.timeout „Çµ„Éù„Éº„ÉàÊ§úÂá∫Èñ¢Êï∞
- [ ] „Çø„Ç§„É†„Ç¢„Ç¶„Éà„Ç∑„Ç∞„Éä„É´‰ΩúÊàêÈñ¢Êï∞Ôºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ‰ªò„ÅçÔºâ
- [ ] „Éñ„É©„Ç¶„Ç∂Ê©üËÉΩÊ§úÂá∫„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£

---

## üü° Phase B: „Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÂçò‰Ωì„ÉÜ„Çπ„Éà (2-3ÊôÇÈñì)

### B.1: Fallback UI„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÉÜ„Çπ„Éà
```typescript
// __tests__/components/VRMViewerFallback.test.tsx
describe('VRMViewerFallback Component', () => {
  test('should render fallback UI when VRM is not supported', () => {
    render(<VRMViewerFallback reason="WebGL not supported" />)
    expect(screen.getByText(/WebGL not supported/i)).toBeInTheDocument()
  })
  
  test('should show loading state', () => {
    render(<VRMViewerFallback loading={true} />)
    expect(screen.getByText(/Loading/i)).toBeInTheDocument()
  })
  
  test('should display error message', () => {
    render(<VRMViewerFallback error="Failed to load VRM file" />)
    expect(screen.getByText(/Failed to load VRM file/i)).toBeInTheDocument()
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] `components/VRMViewerFallback.tsx` „Çí‰ΩúÊàê
- [ ] ÂêÑÁä∂ÊÖãÔºàloading, error, not-supportedÔºâ„ÅÆUIÂÆüË£Ö
- [ ] „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£ÂØæÂøúÔºàARIAÂ±ûÊÄßÔºâ

### B.2: VRMViewer„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÉÜ„Çπ„Éà
```typescript
// __tests__/components/VRMViewer.error.test.tsx
describe('VRMViewer Error Handling', () => {
  test('should handle Three.js initialization errors', async () => {
    // Mock Three.js initialization failure
    jest.spyOn(THREE, 'WebGLRenderer').mockImplementation(() => {
      throw new Error('WebGL context lost')
    })
    
    const { getByText } = render(<VRMViewer />)
    await waitFor(() => {
      expect(getByText(/WebGL context lost/i)).toBeInTheDocument()
    })
  })
  
  test('should handle VRM loading errors', async () => {
    // Mock VRM loading failure
    mockVRMLoader.mockRejectedValue(new Error('Invalid VRM format'))
    
    const { getByText } = render(<VRMViewer modelUrl="/invalid.vrm" />)
    await waitFor(() => {
      expect(getByText(/Invalid VRM format/i)).toBeInTheDocument()
    })
  })
  
  test('should retry loading on error', async () => {
    const { getByRole } = render(<VRMViewer />)
    const retryButton = await screen.findByRole('button', { name: /retry/i })
    
    fireEvent.click(retryButton)
    expect(mockVRMLoader).toHaveBeenCalledTimes(2)
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] VRMViewer„Å´„Ç®„É©„ÉºÂ¢ÉÁïå„ÇíËøΩÂä†
- [ ] „Ç®„É©„ÉºÁä∂ÊÖã„ÅÆÁÆ°ÁêÜ„Å®UIË°®Á§∫
- [ ] „É™„Éà„É©„Ç§Ê©üËÉΩ„ÅÆÂÆüË£Ö

### B.3: VRMViewerÂàùÊúüÂåñ„Éó„É≠„Çª„Çπ„ÉÜ„Çπ„Éà
```typescript
// __tests__/components/VRMViewer.init.test.tsx
describe('VRMViewer Initialization Process', () => {
  test('should initialize in correct order', async () => {
    const initOrder: string[] = []
    
    // MockÂêÑÂàùÊúüÂåñ„Çπ„ÉÜ„ÉÉ„Éó
    jest.spyOn(console, 'log').mockImplementation((msg) => {
      if (msg.includes('Initializing')) initOrder.push(msg)
    })
    
    render(<VRMViewer />)
    
    await waitFor(() => {
      expect(initOrder).toEqual([
        'Initializing Three.js scene...',
        'Creating WebGL renderer...',
        'Loading VRM model...',
        'Setting up animation controller...',
        'VRM initialization complete'
      ])
    })
  })
  
  test('should expose imperative handle methods', async () => {
    const ref = React.createRef<VRMViewerRef>()
    render(<VRMViewer ref={ref} />)
    
    await waitFor(() => {
      expect(ref.current).toBeDefined()
      expect(ref.current).toHaveProperty('lipSync')
      expect(ref.current).toHaveProperty('changeExpression')
      expect(ref.current).toHaveProperty('lookAt')
    })
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] ÂàùÊúüÂåñ„Éó„É≠„Çª„Çπ„ÅÆ„Çπ„ÉÜ„ÉÉ„ÉóÂåñ
- [ ] ÂêÑ„Çπ„ÉÜ„ÉÉ„Éó„Åß„ÅÆ„É≠„Ç∞Âá∫Âäõ
- [ ] useImperativeHandle„ÅÆÈÅ©Âàá„Å™Ë®≠ÂÆö

---

## üü¢ Phase C: Áµ±Âêà„ÉÜ„Çπ„Éà (3-4ÊôÇÈñì)

### C.1: ChatPage„Å®VRMViewerÁµ±Âêà„ÉÜ„Çπ„Éà
```typescript
// __tests__/pages/ChatPage.integration.test.tsx
describe('ChatPage VRMViewer Integration', () => {
  test('should render VRMViewer when conditions are met', async () => {
    // MockÊàêÂäüÊù°‰ª∂
    mockWebGLSupport.mockReturnValue(true)
    mockVRMFileExists.mockResolvedValue(true)
    
    render(<ChatPage />)
    
    await waitFor(() => {
      expect(screen.queryByText(/Loading VRM Viewer/i)).not.toBeInTheDocument()
      expect(screen.getByTestId('vrm-viewer')).toBeInTheDocument()
    })
  })
  
  test('should show fallback when WebGL is not supported', async () => {
    mockWebGLSupport.mockReturnValue(false)
    
    render(<ChatPage />)
    
    await waitFor(() => {
      expect(screen.getByText(/WebGL is not supported/i)).toBeInTheDocument()
    })
  })
  
  test('should handle VRM file missing', async () => {
    mockWebGLSupport.mockReturnValue(true)
    mockVRMFileExists.mockResolvedValue(false)
    
    render(<ChatPage />)
    
    await waitFor(() => {
      expect(screen.getByText(/VRM file not found/i)).toBeInTheDocument()
    })
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] ChatPage„Å´WebGL/VRM„ÉÅ„Çß„ÉÉ„ÇØ„É≠„Ç∏„ÉÉ„ÇØ„ÇíËøΩÂä†
- [ ] Êù°‰ª∂ÂàÜÂ≤ê„ÅßVRMViewer/Fallback„ÇíË°®Á§∫
- [ ] „Ç®„É©„ÉºÁä∂ÊÖã„ÅÆÈÅ©Âàá„Å™ÁÆ°ÁêÜ

### C.2: ÂãïÁöÑ„Ç§„É≥„Éù„Éº„Éà„ÉÜ„Çπ„Éà
```typescript
// __tests__/components/DynamicVRMViewer.test.tsx
describe('Dynamic VRMViewer Import', () => {
  test('should load VRMViewer dynamically on client side', async () => {
    const { container } = render(<DynamicVRMViewer />)
    
    // ÂàùÊúüÁä∂ÊÖã„ÅØ„É≠„Éº„Éá„Ç£„É≥„Ç∞
    expect(screen.getByText(/Loading/i)).toBeInTheDocument()
    
    // ÂãïÁöÑ„Ç§„É≥„Éù„Éº„ÉàÂÆå‰∫ÜÂæå
    await waitFor(() => {
      expect(screen.queryByText(/Loading/i)).not.toBeInTheDocument()
      expect(container.querySelector('canvas')).toBeInTheDocument()
    })
  })
  
  test('should not render on server side', () => {
    // SSRÁí∞Â¢É„Çí„Ç∑„Éü„É•„É¨„Éº„Éà
    const isServer = typeof window === 'undefined'
    if (isServer) {
      const { container } = render(<DynamicVRMViewer />)
      expect(container.innerHTML).toBe('')
    }
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] Next.js dynamic import„ÅÆË®≠ÂÆö
- [ ] SSRÁÑ°ÂäπÂåñ„Ç™„Éó„Ç∑„Éß„É≥„ÅÆËøΩÂä†
- [ ] „É≠„Éº„Éá„Ç£„É≥„Ç∞Áä∂ÊÖã„ÅÆÂÆüË£Ö

### C.3: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà
```typescript
// __tests__/performance/VRMViewer.perf.test.tsx
describe('VRMViewer Performance', () => {
  test('should initialize within acceptable time', async () => {
    const startTime = performance.now()
    
    render(<VRMViewer />)
    
    await waitFor(() => {
      const endTime = performance.now()
      const loadTime = endTime - startTime
      
      expect(loadTime).toBeLessThan(3000) // 3Áßí‰ª•ÂÜÖ
    })
  })
  
  test('should maintain 30+ FPS', async () => {
    const { container } = render(<VRMViewer />)
    
    await waitFor(() => {
      const stats = container.querySelector('.fps-stats')
      const fps = parseInt(stats?.textContent || '0')
      expect(fps).toBeGreaterThanOrEqual(30)
    })
  })
  
  test('should not exceed memory limit', async () => {
    if ('memory' in performance) {
      render(<VRMViewer />)
      
      await waitFor(() => {
        const memoryUsage = (performance as any).memory.usedJSHeapSize
        const limitMB = 200
        expect(memoryUsage / 1024 / 1024).toBeLessThan(limitMB)
      })
    }
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊ∏¨ÂÆöÊ©üËÉΩ„ÅÆËøΩÂä†
- [ ] FPS„Ç´„Ç¶„É≥„Çø„Éº„ÅÆÂÆüË£Ö
- [ ] „É°„É¢„É™‰ΩøÁî®ÈáèÁõ£Ë¶ñ

---

## üîµ Phase D: E2E„ÉÜ„Çπ„Éà„ÉªÂõûÂ∏∞„ÉÜ„Çπ„Éà (2-3ÊôÇÈñì)

### D.1: E2E„Ç∑„Éä„É™„Ç™„ÉÜ„Çπ„Éà
```typescript
// __tests__/e2e/chat-vrm-flow.test.ts
describe('Chat with VRM Avatar E2E', () => {
  test('should complete full chat interaction with avatar', async () => {
    // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„Åø
    await page.goto('/chat')
    
    // VRM„Éì„É•„Éº„Ç¢„Éº„ÅÆË°®Á§∫Á¢∫Ë™ç
    await page.waitForSelector('[data-testid="vrm-viewer"]', { timeout: 5000 })
    
    // „ÉÅ„É£„ÉÉ„ÉàÂÖ•Âäõ
    await page.type('[data-testid="chat-input"]', '„Åì„Çì„Å´„Å°„ÅØ')
    await page.click('[data-testid="send-button"]')
    
    // „É™„ÉÉ„Éó„Ç∑„É≥„ÇØÂãï‰ΩúÁ¢∫Ë™ç
    await page.waitForFunction(() => {
      const viewer = document.querySelector('[data-testid="vrm-viewer"]')
      return viewer?.getAttribute('data-speaking') === 'true'
    })
    
    // Ë°®ÊÉÖÂ§âÂåñÁ¢∫Ë™ç
    await page.waitForFunction(() => {
      const viewer = document.querySelector('[data-testid="vrm-viewer"]')
      return viewer?.getAttribute('data-expression') === 'happy'
    })
  })
  
  test('should handle network errors gracefully', async () => {
    // „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„Çí„Ç∑„Éü„É•„É¨„Éº„Éà
    await page.setOfflineMode(true)
    
    await page.goto('/chat')
    await page.waitForSelector('[data-testid="error-message"]')
    
    // „Ç™„É≥„É©„Ç§„É≥„Å´Êàª„Åô
    await page.setOfflineMode(false)
    await page.click('[data-testid="retry-button"]')
    
    // Âæ©ÊóßÁ¢∫Ë™ç
    await page.waitForSelector('[data-testid="vrm-viewer"]')
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] E2E„ÉÜ„Çπ„ÉàÁí∞Â¢É„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
- [ ] „Éá„Éº„ÇøÂ±ûÊÄß„ÅÆËøΩÂä†Ôºà„ÉÜ„Çπ„ÉàÁî®Ôºâ
- [ ] „Ç®„É©„ÉºÂæ©Êóß„Éï„É≠„Éº„ÅÆÂÆüË£Ö

### D.2: ÂõûÂ∏∞„ÉÜ„Çπ„Éà„Çπ„Ç§„Éº„Éà
```typescript
// __tests__/regression/vrm-viewer.regression.test.ts
describe('VRM Viewer Regression Tests', () => {
  const testCases = [
    { browser: 'chrome', version: 'latest' },
    { browser: 'firefox', version: 'latest' },
    { browser: 'safari', version: '15+' },
    { browser: 'edge', version: 'latest' }
  ]
  
  testCases.forEach(({ browser, version }) => {
    test(`should work in ${browser} ${version}`, async () => {
      // „Éñ„É©„Ç¶„Ç∂Âà•„ÉÜ„Çπ„ÉàÂÆüË°å
      const result = await runInBrowser(browser, version, async () => {
        await page.goto('/chat')
        return await page.evaluate(() => {
          const viewer = document.querySelector('[data-testid="vrm-viewer"]')
          return viewer !== null
        })
      })
      
      expect(result).toBe(true)
    })
  })
  
  test('should maintain backward compatibility', async () => {
    // Êóß„Éê„Éº„Ç∏„Éß„É≥„ÅÆVRM„Éï„Ç°„Ç§„É´„ÉÜ„Çπ„Éà
    const oldVRMFiles = [
      '/models/vrm-0.0-test.vrm',
      '/models/vrm-1.0-test.vrm'
    ]
    
    for (const file of oldVRMFiles) {
      const { container } = render(<VRMViewer modelUrl={file} />)
      await waitFor(() => {
        expect(container.querySelector('canvas')).toBeInTheDocument()
      })
    }
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] „ÇØ„É≠„Çπ„Éñ„É©„Ç¶„Ç∂„ÉÜ„Çπ„ÉàÁí∞Â¢ÉÊßãÁØâ
- [ ] ÂæåÊñπ‰∫íÊèõÊÄß„ÅÆÁ¢∫‰øù
- [ ] „ÉÜ„Çπ„Éà„É¨„Éù„Éº„Éà„ÅÆËá™ÂãïÁîüÊàê

---

## üìä „ÉÜ„Çπ„Éà„Ç´„Éê„É¨„ÉÉ„Ç∏ÁõÆÊ®ô

### Âçò‰Ωì„ÉÜ„Çπ„Éà
- [ ] WebGLÂØæÂøú„ÉÅ„Çß„ÉÉ„ÇØ: 100%
- [ ] VRM„Éï„Ç°„Ç§„É´Âá¶ÁêÜ: 95%+
- [ ] „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞: 90%+
- [ ] UI „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà: 85%+

### Áµ±Âêà„ÉÜ„Çπ„Éà
- [ ] ChatPageÁµ±Âêà: 80%+
- [ ] ÂãïÁöÑ„Ç§„É≥„Éù„Éº„Éà: 90%+
- [ ] „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ: Âü∫Ê∫ñÂÄ§ÈÅîÊàê

### E2E„ÉÜ„Çπ„Éà
- [ ] ‰∏ªË¶Å„Ç∑„Éä„É™„Ç™: 100%
- [ ] „Ç®„É©„ÉºÂæ©Êóß: 100%
- [ ] „ÇØ„É≠„Çπ„Éñ„É©„Ç¶„Ç∂: 4„Éñ„É©„Ç¶„Ç∂ÂØæÂøú

---

## üöÄ ÂÆüË°åÈ†ÜÂ∫è„Å®ÂÑ™ÂÖàÂ∫¶ÔºàÊîπË®ÇÁâàÔºâ

### üî• Day 0: Á∑äÊÄ•‰øÆÊ≠£ (1-2ÊôÇÈñì) - Âç≥Â∫ßÂÆüË°å
1. **Critical Fixes (1h)**
   - [ ] AbortSignal.timeout()„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂÆüË£Ö
   - [ ] package.jsonÁõ¥Êé•„Ç¢„ÇØ„Çª„ÇπÈô§Âéª
   - [ ] Âãï‰ΩúÁ¢∫Ë™ç„Å®„Éì„É´„Éâ„ÉÜ„Çπ„Éà

### Day 1: Âü∫Áõ§ÊßãÁØâ
1. **Morning (2-3h)**
   - [ ] Phase A.1-A.4: Áí∞Â¢ÉÁ¢∫Ë™ç„ÉÜ„Çπ„Éà‰ΩúÊàê„ÉªÂÆüË£ÖÔºà„Éñ„É©„Ç¶„Ç∂‰∫íÊèõÊÄßÂê´„ÇÄÔºâ
   - [ ] Phase B.1: Fallback UI„ÉÜ„Çπ„Éà„ÉªÂÆüË£Ö

2. **Afternoon (3-4h)**
   - [ ] Phase B.2: „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞„ÉÜ„Çπ„Éà„ÉªÂÆüË£Ö
   - [ ] Phase B.3: ÂàùÊúüÂåñ„Éó„É≠„Çª„Çπ„ÉÜ„Çπ„Éà„ÉªÂÆüË£Ö

### Day 2: Áµ±Âêà„Å®ÊúÄÈÅ©Âåñ
3. **Morning (2-3h)**
   - [ ] Phase C.1: ChatPageÁµ±Âêà„ÉÜ„Çπ„Éà„ÉªÂÆüË£Ö
   - [ ] Phase C.2: ÂãïÁöÑ„Ç§„É≥„Éù„Éº„Éà„ÉÜ„Çπ„Éà„ÉªÂÆüË£Ö

4. **Afternoon (3-4h)**
   - [ ] Phase C.3: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÉÜ„Çπ„Éà„ÉªÂÆüË£Ö
   - [ ] Phase D.1: E2E„ÉÜ„Çπ„Éà‰ΩúÊàê

### Day 3: ÂìÅË≥™‰øùË®º
5. **Morning (2h)**
   - [ ] Phase D.2: ÂõûÂ∏∞„ÉÜ„Çπ„ÉàÂÆüË°å
   - [ ] „Éê„Ç∞‰øÆÊ≠£„Å®„É™„Éï„Ç°„ÇØ„Çø„É™„É≥„Ç∞

6. **Afternoon (2h)**
   - [ ] „Éâ„Ç≠„É•„É°„É≥„ÉàÊõ¥Êñ∞
   - [ ] „Éá„Éó„É≠„Ç§Ê∫ñÂÇô

---

## ‚úÖ ÂÆå‰∫ÜÂü∫Ê∫ñ

### Red-Green-Refactor „Çµ„Ç§„ÇØ„É´ÂÆå‰∫Ü
- [ ] ÂÖ®„ÉÜ„Çπ„Éà„ÅåÊúÄÂàù„ÅØÂ§±ÊïóÔºàRedÔºâ
- [ ] ÊúÄÂ∞èÈôê„ÅÆÂÆüË£Ö„ÅßÈÄöÈÅéÔºàGreenÔºâ
- [ ] „Ç≥„Éº„ÉâÂìÅË≥™Âêë‰∏äÔºàRefactorÔºâ

### ÂìÅË≥™Âü∫Ê∫ñ
- [ ] „ÉÜ„Çπ„Éà„Ç´„Éê„É¨„ÉÉ„Ç∏ 80%‰ª•‰∏ä
- [ ] ÂÖ®„Å¶„ÅÆ„ÉÜ„Çπ„Éà„ÅåÈÄöÈÅé
- [ ] „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂü∫Ê∫ñ„ÇíÊ∫Ä„Åü„Åô
- [ ] „Éâ„Ç≠„É•„É°„É≥„Éà„ÅåÊúÄÊñ∞

### „Éá„É™„Éê„É™„ÉºÂü∫Ê∫ñ
- [ ] VRMViewer„ÅåÊ≠£Â∏∏„Å´Ë°®Á§∫„Åï„Çå„Çã
- [ ] „Ç®„É©„ÉºÊôÇ„ÅØFallback UI„ÅåË°®Á§∫„Åï„Çå„Çã
- [ ] ÂÖ®‰∏ªË¶Å„Éñ„É©„Ç¶„Ç∂„ÅßÂãï‰ΩúÁ¢∫Ë™çÊ∏à„Åø
- [ ] „É¶„Éº„Ç∂„Éº‰ΩìÈ®ì„ÅåÊêç„Å™„Çè„Çå„Å™„ÅÑ

---

## üìù Ê≥®ÊÑè‰∫ãÈ†Ö

1. **TDD„ÅÆÂé≥ÂÆà**
   - ÂøÖ„Åö„ÉÜ„Çπ„Éà„ÇíÂÖà„Å´Êõ∏„Åè
   - „ÉÜ„Çπ„Éà„ÅåÂ§±Êïó„Åô„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
   - ÊúÄÂ∞èÈôê„ÅÆÂÆüË£Ö„ÅßÈÄöÈÅé„Åï„Åõ„Çã

2. **ÊÆµÈöéÁöÑ„Å™ÂÆüË£Ö**
   - ‰∏ÄÂ∫¶„Å´Â§ö„Åè„ÇíÂÆüË£Ö„Åó„Å™„ÅÑ
   - ÂêÑÊÆµÈöé„ÅßÂãï‰ΩúÁ¢∫Ë™ç
   - „É™„Éï„Ç°„ÇØ„Çø„É™„É≥„Ç∞„ÅØÂà•„Çπ„ÉÜ„ÉÉ„Éó„Åß

3. **Á∂ôÁ∂öÁöÑ„Å™Ê§úË®º**
   - CI„Åß„ÉÜ„Çπ„ÉàËá™ÂãïÂÆüË°å
   - „Ç≥„Éº„Éâ„É¨„Éì„É•„Éº„ÅÆÂÆüÊñΩ
   - „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñ

4. **„Éâ„Ç≠„É•„É°„É≥„ÉàÊõ¥Êñ∞**
   - „ÉÜ„Çπ„Éà„Ç±„Éº„Çπ„ÅÆË™¨Êòé
   - ÂÆüË£Ö„ÅÆÂà§Êñ≠ÁêÜÁî±
   - ‰ªäÂæå„ÅÆÊîπÂñÑÁÇπ

5. **„Éñ„É©„Ç¶„Ç∂‰∫íÊèõÊÄßËÄÉÊÖÆ**
   - Êñ∞„Åó„ÅÑAPI„ÅÆ‰ΩøÁî®Ââç„Å´„Çµ„Éù„Éº„ÉàÁ¢∫Ë™ç
   - „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂÆüË£Ö„ÅÆÊèê‰æõ
   - Can I Use„Åß„ÅÆÁ¢∫Ë™çÁøíÊÖ£Âåñ

6. **Next.jsÂà∂Á¥Ñ„Å∏„ÅÆÂØæÂøú**
   - ÂãïÁöÑrequire()„ÅÆÂõûÈÅø
   - ES ModuleÊ∫ñÊã†„ÅÆÂÆüË£Ö
   - SSR/CSRÁí∞Â¢É„ÅÆËÄÉÊÖÆ

---

## üö® Á∑äÊÄ•‰øÆÊ≠£„Çø„Çπ„ÇØ (2025/01/06 ËøΩÂä†)

### üî• Critical: AbortSignal.timeout()‰∫íÊèõÊÄß‰øÆÊ≠£

**ÂïèÈ°å**: Âè§„ÅÑ„Éñ„É©„Ç¶„Ç∂„Åß`AbortSignal.timeout()`„ÅåÊú™ÂØæÂøú„ÅÆ„Åü„ÇÅ„ÄÅVRMË™≠„ÅøËæº„Åø„ÉÅ„Çß„ÉÉ„ÇØ„ÅßÂá¶ÁêÜ„ÅåÂÅúÊ≠¢

**‰øÆÊ≠£„ÉÜ„Çπ„Éà**:
```typescript
// __tests__/utils/vrm-loader.hotfix.test.ts
describe('VRM Loader Hotfix', () => {
  test('should use AbortController fallback when timeout not supported', async () => {
    // timeout„É°„ÇΩ„ÉÉ„Éâ„ÇíÂâäÈô§„Åó„Å¶„ÉÜ„Çπ„Éà
    const original = AbortSignal.timeout
    delete (AbortSignal as any).timeout
    
    const result = await checkVRMFileExists('/models/test.vrm')
    expect(result).toBeDefined()
    
    // Âæ©ÂÖÉ
    (AbortSignal as any).timeout = original
  })
})
```

**Âç≥Â∫ßÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] createTimeoutSignalÈñ¢Êï∞„ÅÆÂÆüË£ÖÔºà30ÂàÜÔºâ
- [ ] checkVRMFileExists‰øÆÊ≠£Ôºà15ÂàÜÔºâ
- [ ] getVRMFileInfo‰øÆÊ≠£Ôºà15ÂàÜÔºâ
- [ ] Âãï‰ΩúÁ¢∫Ë™çÔºà15ÂàÜÔºâ

### üîß High Priority: package.jsonÁõ¥Êé•„Ç¢„ÇØ„Çª„ÇπÈô§Âéª

**ÂïèÈ°å**: Next.js 14.2.29„Åßpackage.json„Å∏„ÅÆÂãïÁöÑrequire()„ÅåÁ¶ÅÊ≠¢

**‰øÆÊ≠£„ÉÜ„Çπ„Éà**:
```typescript
// __tests__/pages/ChatPage.compile.test.tsx
describe('ChatPage Compilation Fix', () => {
  test('should not contain direct package.json imports', () => {
    const chatPageSource = fs.readFileSync('./app/chat/page.tsx', 'utf-8')
    expect(chatPageSource).not.toContain("require('three/package.json')")
    expect(chatPageSource).not.toContain("require('@pixiv/three-vrm/package.json')")
  })
})
```

**ÂÆüË£Ö„Çø„Çπ„ÇØ**:
- [ ] getThreeJsVersionÈñ¢Êï∞ÂÆüË£ÖÔºàÂÆå‰∫ÜÊ∏à„ÅøÔºâ
- [ ] getVRMLibVersionÈñ¢Êï∞ÂÆüË£ÖÔºà30ÂàÜÔºâ
- [ ] ChatPage‰øÆÊ≠£ÈÅ©Áî®Ôºà15ÂàÜÔºâ
- [ ] „Éì„É´„ÉâÁ¢∫Ë™çÔºà15ÂàÜÔºâ
